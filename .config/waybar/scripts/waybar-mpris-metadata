#!/usr/bin/env bash

# Required: playerctl (for MPRIS)
PLAYER=ncspot

icon=""

artist=$(playerctl -p "$PLAYER" metadata artist 2>/dev/null)
title=$(playerctl -p "$PLAYER" metadata title 2>/dev/null)
status=$(playerctl -p "$PLAYER" status 2>/dev/null)

# If not playing, just icon
if [[ "$status" != "Playing" && "$status" != "Paused" ]]; then
  artist=""
  title=""
fi

if [[ "$WAYBAR_HOVERED" == "1" && -n "$artist" && -n "$title" ]]; then
  text="$artist - $title"
else
  text=""
fi

# Output JSON for waybar
echo "{\"icon\": \"$icon\", \"text\": \"$text\"}"

